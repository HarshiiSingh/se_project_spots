!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_type_error",inputErrorClass:"modal__input_type_error"},t=(e,t,o)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(o.inputErrorClass)},o=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?n(t,o):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},r=e=>{document.querySelectorAll(e.formSelector).forEach((n=>{((e,n)=>{const r=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);o(r,a,n),r.forEach((c=>{c.addEventListener("input",(function(){((e,o,n)=>{o.validity.valid?t(e,o,n):((e,t,o,n)=>{e.querySelector(`#${t.id}-error`).textContent=o,t.classList.add(n.inputErrorClass)})(e,o,o.validationMessage,n)})(e,c,n),o(r,a,n)}))}))})(n,e)}))};r(e);const a=document.querySelector(".profile__edt-btn"),c=document.querySelector(".profile__name"),s=document.querySelector(".profile__description"),l=document.querySelector("#edit-profile-modal"),i=l.querySelector("#profile-name-input"),d=l.querySelector("#profile-description-input"),u=l.querySelector(".modal__form"),m=document.querySelector("#card-template"),p=document.querySelector(".cards__list"),_=document.querySelector("#preview-modal"),f=_.querySelector(".modal__image"),y=_.querySelector(".modal__caption");function v(e){const t=m.content.querySelector(".card").cloneNode(!0),o=t.querySelector(".card__title"),n=t.querySelector(".card__image"),r=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return o.textContent=e.name,n.alt=e.name,n.src=e.link,a.addEventListener("click",(()=>{t.remove()})),r.addEventListener("click",(()=>{r.classList.toggle("card__like-btn_liked")})),n.addEventListener("click",(()=>{S(_),f.src=e.link,f.alt=e.name,y.textContent=e.name})),t}function S(e){e.classList.add("modal_opened"),e.addEventListener("click",x),document.addEventListener("keydown",L)}function q(e){e.classList.remove("modal_opened"),e.removeEventListener("click",x),document.removeEventListener("keydown",L)}a.addEventListener("click",(()=>{var o,n;i.value=c.textContent,d.value=s.textContent,o=u,n=e,[i,d].forEach((e=>{t(o,e,n)})),S(l)})),u.addEventListener("submit",(function(e){e.preventDefault(),c.textContent=i.value,s.textContent=d.value,q(l)}));const g=document.querySelector(".profile__add-btn"),h=document.querySelector("#add-card-profile-modal"),b=h.querySelector(".modal__submit-btn"),k=h.querySelector(".modal__form"),w=h.querySelector("#add-card-link-input"),E=h.querySelector("#add-card-name-input");function L(e){if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&q(e.closest(".modal"))}}function x(e){e.target.classList.contains("modal")&&q(e.target)}g.addEventListener("click",(()=>{S(h)})),k.addEventListener("submit",(function(t){t.preventDefault();const o=v({name:E.value,link:w.value});p.prepend(o),n(b,e),q(h),t.target.reset()})),document.querySelectorAll(".modal__close-btn").forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>q(t)))})),[{name:"Val Thorens",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/1-photo-by-moritz-feldmann-from-pexels.jpg"},{name:"Restaurant terrace",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/2-photo-by-ceiline-from-pexels.jpg"},{name:"An outdoor cafe",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/3-photo-by-tubanur-dogan-from-pexels.jpg"},{name:"A very long bridge, over the forest and through the trees",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/4-photo-by-maurice-laschet-from-pexels.jpg"},{name:"Tunnel with morning light",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/5-photo-by-van-anh-nguyen-from-pexels.jpg"},{name:"Mountain house",link:"https://practicum-content.s3.us-west-1.amazonaws.com/software-engineer/spots/6-photo-by-moritz-feldmann-from-pexels.jpg"}].forEach((e=>{const t=v(e);p.append(t)})),r(e)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TSxHQUN6QixHQUFnQixXQUFaQSxFQUFJUSxJQUFrQixDQUN4QixNQUFNQyxFQUFjeEQsU0FBU2hCLGNBQWMsaUJBQ3ZDd0UsR0FDRmQsRUFBV2MsRUFBWUMsUUFBUSxVQUVuQyxDQUNGLENBRUEsU0FBU2pCLEVBQW1CTyxHQUN0QkEsRUFBSVcsT0FBT3ZFLFVBQVV3RSxTQUFTLFVBQ2hDakIsRUFBV0ssRUFBSVcsT0FFbkIsQ0FyQkFULEVBQWExQyxpQkFBaUIsU0FBUyxLQUNyQytCLEVBQVVZLEVBQVUsSUFJdEJFLEVBQVM3QyxpQkFBaUIsVUFqQjFCLFNBQThCd0MsR0FDNUJBLEVBQUlDLGlCQUVKLE1BQ01ZLEVBQVNwQyxFQURDLENBQUNTLEtBQU1xQixFQUFzQlQsTUFBT1QsS0FBTWlCLEVBQW1CUixRQUU3RXpCLEVBQVV5QyxRQUFRRCxHQUNsQmhFLEVBQWN1RCxFQUFlN0UsR0FDN0JvRSxFQUFXUSxHQUNYSCxFQUFJVyxPQUFPSSxPQUNiLElBMEJxQjlELFNBQVNDLGlCQUFpQixxQkFFbENDLFNBQVM2RCxJQUNwQixNQUFNQyxFQUFhRCxFQUFPTixRQUFRLFVBQ2xDTSxFQUFPeEQsaUJBQWlCLFNBQVMsSUFBTW1DLEVBQVdzQixJQUFZLElBdkwzQyxDQUFDLENBQ3BCL0IsS0FBTSxjQUNORyxLQUFNLDJIQUVSLENBQ0VILEtBQU0scUJBQ05HLEtBQU0sbUhBRVIsQ0FDRUgsS0FBTSxrQkFDTkcsS0FBTSx5SEFFUixDQUNFSCxLQUFNLDREQUNORyxLQUFNLDJIQUVSLENBQ0VILEtBQU0sNEJBQ05HLEtBQU0sMEhBRVIsQ0FDRUgsS0FBTSxpQkFDTkcsS0FBTSw0SEFxS0tsQyxTQUFTK0QsSUFDcEIsTUFBTUwsRUFBU3BDLEVBQWV5QyxHQUM5QjdDLEVBQVU4QyxPQUFPTixFQUFPLElBRzFCN0QsRUFBaUJ6QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX3R5cGVfZXJyb3JcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIC8vIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIlxufVxuXG4vLyBBZGRzIGVycm9yIG1lc3NhZ2UgZnJvbSBtb2RhbFxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTsgLy8gZmluZHMgc3BlY2lmaWMgZXJyb3IgaHRtbCAoc3BhbiB0YWcpIGZvciBtb2RhbCB1c2luZyBJRCBmcm9tIHRoZSBtb2RhbF9fZm9ybVxuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlOyAvLyBnZXRzIHNwZWNpZmljIGVycm9yTWVzc2FnZSBmcm9tIHRoZSAudmFsaWRhdGlvbk1lc3NhZ2UgcHJvcGVydHkgYW5kIGFkZHMgaXQgdG8gc3BhbiB0YWdcbiAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7IC8vIGFkZHMgQ1NTIGZvciBlcnJvck1lc3NhZ2Vcbn07XG5cbi8vIFJlbW92ZXMgZXJyb3IgbWVzc2FnZSBmcm9tIG1vZGFsXG5jb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApOyAvLyBmaW5kcyBzcGVjaWZpYyBlcnJvciBodG1sIChzcGFuIHRhZykgZm9yIG1vZGFsIHVzaW5nIElEIGZyb20gdGhlIG1vZGFsX19mb3JtXG4gIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7IC8vIHJlbW92ZXMgZXJyb3IgbWVzc2FnZVxuICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTsgLy8gcmVtb3ZlcyBDU1MgZm9yIGVycm9yIG1lc3NhZ2Vcbn07XG5cbi8vIFRlbGxzIGlmIGF0IGxlYXN0IE9ORSBvZiB0aGUgaW5wdXRzIGFyZSBpbnZhbGlkXG5jb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gIC8vIElmIGJvdGggSW5wdXRzIGFyZSBjb3JyZWN0IHdpbGwgcmV0dXJuIGZhbHNlLCBpZiBhdCBsZWFzdCBvbmUgaW5wdXQgaXMgaW5jb3JyZWN0IGl0IHdpbGwgcmV0dXJuIHRydWVcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICByZXR1cm4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZDsgLy8gV2lsbCByZXR1cm4gd2hldGhlciBjdXJyZW50IGlucHV0IGlzIHZhbGlkIG9yIGludmFsaWRcbiAgfSk7XG59O1xuXG4vLyBDaGVja3Mgd2hldGhlciBidXR0b24gc2hvdWxkIGJlIGRpc2FibGVkIG9yIGVuYWJsZWRcbmNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIC8vIElmIGJ1dHRvbiBoYXMgYXQgbGVhc3Qgb25lIGludmFsaWQgaW5wdXQgKHdoaWNoIGl0IHNob3VsZCBieSBkZWZhdWx0KSBkaXNhYmxlcyBidXR0b24uIChVc2VyIG11c3QgbWFrZSBjaGFuZ2VzIGluIHRoZSBlZGl0IHByb2ZpbGUgbW9kYWwgYW5kIHRoZSBOZXcgUG9zdCBtb2RhbCBtdXN0IGhhdmUgYSB2YWxpZCBpbnB1dClcbiAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgLy8gSWYgY29ycmVjdCBpbnB1dCB0aGVuIGVuYWJsZXMgYnV0dG9uIGFuZCByZW1vdmVzIGluYWN0aXZlIGJ1dHRvbiBjc3NcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gZmFsc2U7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuLy8gZnVuY3Rpb24gZm9yICBkaXNhYmxpbmcgdGhlIGJ1dHRvbkVsZW1lbnQsIHRoaXMgYWxsb3dzIHVzIHRvIGRpc2FibGUgYnV0dG9uIGZyb20gYnV0dG9uIHN1Ym1pdCBpbiBpbmRleC5qc1xuZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpOyAvLyBBZGRzIGluYWN0aXZlIGJ1dHRvbiBjc3MgKGdyZXlzIG91dCB0aGUgYnV0dG9uKVxufVxuXG4vLyBIaWRlcyBlcnJvciBtZXNzYWdlcyB3aGVuIG9wZW5pbmcgbW9kYWwgKHVzZWQgZm9yIGVkaXQgcHJvZmlsZSBtb2RhbCksIHNvIHdoZW4gdXNlciBoYXMgYW4gZXJyb3IgaW4gdGhlIG1vZGFsIGFuZCByZW9wZW5zIGl0LCB0aGUgZXJyb3IgZG9lcyBub3QgcmVhcHBlYXIgd2hlbiB0aGVyZSBzaG91bGRuJ3QgYmVcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsZW1lbnQsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgfSk7XG5cbn07XG5cbi8vIENoZWNrcyBvbiB3aGV0aGVyIGlucHV0IGlzIHZhbGlkIG9yIG5vdFxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgIC8vIGlmIGlucHV0RWxlbWVudCBpcyBpbnZhbGlkIHRoZW4gc2hvd2Nhc2VzIGVycm9yIG9uIElucHV0XG4gICAgc2hvd0lucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlLCBjb25maWcpO1xuICB9IGVsc2Uge1xuICAgIC8vIE90aGVyd2lzZSBpdCBkb2Vzbid0IHNob3cgZXJyb3JcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICB9XG59XG5cbi8vIFRoaXMgc2V0cyB0aGUgZXZlbnQgbGlzdGVuZXJzIGZvciBib3RoIG1vZGFscyBvbiB0aGUgcGFnZVxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTsgLy8gZ2V0cyB0aGUgaW5wdXRzIGZvciBlYWNoIG1vZGFsIChjdXJyZW50bHkgMiBpbnB1dHMgcGVyIG1vZGFsKVxuICBjb25zdCBidXR0b25FbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpOyAvLyBnZXRzIHRoZSBzdWJtaXQgYnV0dG9uIGluIHRoZSBtb2RhbFxuXG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpOyAvLyBjcmVhdGVzIGluYWN0aXZlIGJ1dHRvbiBzdGF0ZSBmcm9tIHdlYnBhZ2UgbGF1bmNoXG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgZnVuY3Rpb24gKCkgeyAvLyBBZGRzIGJvdGggZnVuY3Rpb25zIHRvIGVhY2ggaW5wdXQgb24gYm90aCBNb2RhbHNcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpOyAvLyBGb3IgZXZlcnkgaW5wdXQgY2hlY2tzIHRvIHNlZSBpZiBpbnB1dCBpcyB2YWxpZFxuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpOyAvLyBpZiBpbnB1dCBpcyB2YWxpZC9pbnZhbGlkIGJ1dHRvbiBzaG91bGQgZm9sbG93IHRoYXRcbiAgICB9KTtcbiAgfSk7XG59O1xuXG4vLyBFbmFibGVzIGFsbCBmdW5jdGlvbnMgaW4gdmFsaWRhdGlvbi5qc1xuZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgZm9ybXMgYW5kIHNldCBldmVudCBsaXN0ZW5lcnMgdGhyb3VnaG91dCB0aGUgZm9ybVxuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7IC8vIGJvdGggZm9ybXMgb24gdGhlIHdlYnBhZ2VcbiAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsKSA9PiB7XG4gICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn1cblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7IiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHNldHRpbmdzLCByZXNldFZhbGlkYXRpb24sIGRpc2FibGVCdXR0b24gfSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5jb25zdCBpbml0aWFsQ2FyZHMgPSBbe1xuICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4gIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8xLXBob3RvLWJ5LW1vcml0ei1mZWxkbWFubi1mcm9tLXBleGVscy5qcGdcIixcbn0sXG57XG4gIG5hbWU6IFwiUmVzdGF1cmFudCB0ZXJyYWNlXCIsXG4gIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy8yLXBob3RvLWJ5LWNlaWxpbmUtZnJvbS1wZXhlbHMuanBnXCIsXG59LFxue1xuICBuYW1lOiBcIkFuIG91dGRvb3IgY2FmZVwiLFxuICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxufSxcbntcbiAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbiAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzQtcGhvdG8tYnktbWF1cmljZS1sYXNjaGV0LWZyb20tcGV4ZWxzLmpwZ1wiLFxufSxcbntcbiAgbmFtZTogXCJUdW5uZWwgd2l0aCBtb3JuaW5nIGxpZ2h0XCIsXG4gIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9zcG90cy81LXBob3RvLWJ5LXZhbi1hbmgtbmd1eWVuLWZyb20tcGV4ZWxzLmpwZ1wiLFxufSxcbntcbiAgbmFtZTogXCJNb3VudGFpbiBob3VzZVwiLFxuICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG59XTtcblxuXG4vLyBDbG9zZSBCdXR0b25cblxuXG5cbi8vIEVkaXQgUHJvZmlsZSBNb2RhbCBTZWN0aW9uXG4vLyBFZGl0IFByb2ZpbGUgQnV0dG9uXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWR0LWJ0blwiKTtcblxuLy8gUGFnZSBOYW1lIGFuZCBEZXNjcmlwdGlvbiBjdXJyZW50IHZhbHVlc1xuY29uc3QgcHJvZmlsZU5hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5cbi8vIEVkaXQgUHJvZmlsZSBNb2RhbFxuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdE5hbWVNb2RhbElucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGVkaXREZXNjcmlwdGlvbk1vZGFsSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiKTtcblxuLy8gQWNjZXNzIGZvcm0gb24gRWRpdCBQcm9maWxlIE1vZGFsXG5jb25zdCBlZGl0Rm9ybUVsZW1lbnQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbi8vIEFjY2VzcyBDYXJkIFRlbXBsYXRlIGFuZCBDYXJkIExpc3RcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbi8vIFNlbGVjdCBQcmV2aWV3IE1vZGFsXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBwcmV2aWV3TW9kYWxJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld01vZGFsQ2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbi8vIENyZWF0ZXMgTmV3IFRlbXBsYXRlcyBidXQgZG9lc24ndCBhZGQgdG8gQ2FyZHNMaXN0XG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpLmNsb25lTm9kZSh0cnVlKTtcblxuICBjb25zdCBjYXJkTmFtZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG5cblxuICBjYXJkTmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcblxuXG4gIC8vIEV2ZW50IExpc3RlbmVyIG9uIERlbGV0ZSBCdXR0b25cbiAgY2FyZERlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xuICB9KTtcblxuICBjYXJkTGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNhcmRMaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgICAgcHJldmlld01vZGFsSW1hZ2VFbC5zcmMgPSBkYXRhLmxpbms7XG4gICAgIHByZXZpZXdNb2RhbEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xuICAgICBwcmV2aWV3TW9kYWxDYXB0aW9uRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG5cbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLyBGdW5jdGlvbiB0byBPcGVuIE1vZGFsXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlQcmVzcyk7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZU1vZGFsKTtcbn1cblxuLy8gRnVuY3Rpb24gdG8gQ2xvc2UgTW9kYWxcbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlQcmVzcyk7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZU1vZGFsKTtcbn1cblxuLy8gU3VibWl0cyBGb3JtIG9uIFwiRWRpdCBQcm9maWxlXCIgbW9kYWwgYW5kIHVwZGF0ZXMgcHJvZmlsZSBvbiBwYWdlXG5mdW5jdGlvbiBoYW5kbGVFZGl0Rm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgcHJvZmlsZU5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZWRpdE5hbWVNb2RhbElucHV0LnZhbHVlO1xuICBwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gZWRpdERlc2NyaXB0aW9uTW9kYWxJbnB1dC52YWx1ZTtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn1cblxuXG4vLyBPcGVucyBcIkVkaXQgUHJvZmlsZSBNb2RhbFwiXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBlZGl0TmFtZU1vZGFsSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIGVkaXREZXNjcmlwdGlvbk1vZGFsSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oZWRpdEZvcm1FbGVtZW50LCBbZWRpdE5hbWVNb2RhbElucHV0LCBlZGl0RGVzY3JpcHRpb25Nb2RhbElucHV0XSwgc2V0dGluZ3MpIC8vIGhpZGVzIGVycm9yIG1lc3NhZ2UgZm9yIGJvdGggaW5wdXRzIGlmIHVzZXIgcmVjZWl2ZWQgYW4gZXJyb3IgYW5kIGNsb3NlZCBtb2RhbCB3aXRob3V0IGZpeGluZyB0aGUgZXJyb3JcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbi8vIFN1Ym1pdHMgdGV4dCBpbnB1dHRlZCB0aHJvdWdoIHRoZSBwcm9maWxlIG1vZGFsIGFuZCBjbG9zZXMgbW9kYWxcbmVkaXRGb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUVkaXRGb3JtU3VibWl0KTtcblxuXG4vLyBcIk5ldyBQb3N0XCIgTW9kYWwgU2VjdGlvblxuXG4vLyBOZXcgUG9zdCBCdXR0b25cbmNvbnN0IGNhcmRNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTsgLy9cblxuLy8gTmV3IFBvc3Qgc3VibWlzc2lvbiBNb2RhbFxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgY2FyZFN1Ym1pdEJ0biA9IGNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpXG5cbi8vIEFjY2Vzc2VzIGZvcm0gb24gbmV3IGZvcm0gbW9kYWxcbmNvbnN0IGNhcmRGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbi8vIElucHV0IGluZm9ybWF0aW9uIG9uIE1vZGFsXG5jb25zdCBlZGl0TGlua01vZGFsSW5wdXQgPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1saW5rLWlucHV0XCIpO1xuY29uc3QgZWRpdENhcHRpb25Nb2RhbElucHV0ID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbmFtZS1pbnB1dFwiKTtcblxuLy8gRnVuY3Rpb24gdG8gYWRkIG5ldyBDYXJkIHRvIHBhZ2VcbmZ1bmN0aW9uIGhhbmRsZUNhcmRGb3JtU3VibWl0KGV2dCkge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBuZXdDYXJkID0ge25hbWU6IGVkaXRDYXB0aW9uTW9kYWxJbnB1dC52YWx1ZSwgbGluazogZWRpdExpbmtNb2RhbElucHV0LnZhbHVlfTtcbiAgY29uc3QgY2FyZEVsID0gZ2V0Q2FyZEVsZW1lbnQobmV3Q2FyZCk7IC8vIGNyZWF0ZXMgdGVtcGxhdGUgZnJvbSBuZXdDYXJkIG9iamVjdFxuICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWwpOyAvLyBBZGRzIHRvIGJlZ2lubmluZyBvZiBhcnJheVxuICBkaXNhYmxlQnV0dG9uKGNhcmRTdWJtaXRCdG4sIHNldHRpbmdzKTsgLy8gZGlzYWJsZXMgYnV0dG9uIGFmdGVyIHN1Ym1pc3Npb24gc28gdXNlciBjYW4ndCBzdWJtaXQgd2l0aG91dCBtYWtpbmcgYW4gZWRpdFxuICBjbG9zZU1vZGFsKGNhcmRNb2RhbCk7XG4gIGV2dC50YXJnZXQucmVzZXQoKTtcbn1cblxuLy8gT3BlbnMgXCJOZXcgUG9zdCBNb2RhbFwiXG5jYXJkTW9kYWxCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGNhcmRNb2RhbCk7XG59KTtcblxuLy8gU3VibWl0cyBQb3N0IGZyb20gTW9kYWxcbmNhcmRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlQ2FyZEZvcm1TdWJtaXQpO1xuXG4vLyBDbG9zaW5nIHRoZSBNb2RhbCB1c2luZyB0aGUgRXNjYXBlIGtleSBhbmQgT3ZlcmxheSBDbGlja1xuZnVuY3Rpb24gaGFuZGxlRXNjYXBlTW9kYWwoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3QgbW9kYWxPcGVuZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTsgLy8gU2VsZWN0cyB0aGUgTW9kYWwgd2l0aCB0aGUgbW9kYWxfb3BlbmVkIGF0dHJpYnV0ZVxuICAgIGlmIChtb2RhbE9wZW5lZCkge1xuICAgICAgY2xvc2VNb2RhbChtb2RhbE9wZW5lZC5jbG9zZXN0KFwiLm1vZGFsXCIpKTsgLy8gY2xvc2VzIHRoZSBtb2RhbCB0aGF0IGlzIHRoZSBjbG9zZXN0IGFuY2VzdG9yIHRvIG1vZGFsX29wZW5lZCAoLm1vZGFsIGluIHRoaXMgY2FzZSlcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFuZGxlT3ZlcmxheVByZXNzKGV2dCkge1xuICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkgeyAvLyB3aGF0IHRoZSB1c2VyIGlzIGNsaWNraW5nIG9uIGhhcyB0aGUgbW9kYWwgYXR0cmlidXRlIChhbnl0aGluZyB0aGF0IGlzbid0IHRoZSBjb250YWluZXIgd2hlbiB0aGUgbW9kYWwgaXMgb3BlbmVkKVxuICAgIGNsb3NlTW9kYWwoZXZ0LnRhcmdldCk7IC8vIGNsb3NlcyB0aGUgbW9kYWxcbiAgfVxufVxuXG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5cbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgY29uc3QgY2xvc2VQb3B1cCA9IGJ1dHRvbi5jbG9zZXN0KFwiLm1vZGFsXCIpO1xuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBjbG9zZU1vZGFsKGNsb3NlUG9wdXApKTtcbn0pXG5cbi8vIExvb3BzIHRocm91Z2ggYXJyYXkgYW5kIGNyZWF0ZXMgYSBUZW1wbGF0ZSBmb3JFYWNoIG9iamVjdCBpbiBhcnJheSBhbmQgYWRkcyB0byB1bCBjbGFzcyBcIi5jYXJkc19fbGlzdFwiXG5pbml0aWFsQ2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICBjb25zdCBjYXJkRWwgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgY2FyZHNMaXN0LmFwcGVuZChjYXJkRWwpO1xufSk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpOyJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbGVtZW50IiwiaW5wdXRFbGVtZW50IiwiY29uZmlnIiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJzb21lIiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImFkZCIsImVuYWJsZVZhbGlkYXRpb24iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZm9ybUVsIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInByb2ZpbGVFZGl0QnV0dG9uIiwicHJvZmlsZU5hbWVFbGVtZW50IiwicHJvZmlsZURlc2NyaXB0aW9uRWxlbWVudCIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0TmFtZU1vZGFsSW5wdXQiLCJlZGl0RGVzY3JpcHRpb25Nb2RhbElucHV0IiwiZWRpdEZvcm1FbGVtZW50IiwiY2FyZFRlbXBsYXRlIiwiY2FyZHNMaXN0IiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsSW1hZ2VFbCIsInByZXZpZXdNb2RhbENhcHRpb25FbCIsImdldENhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRFbGVtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsImNhcmROYW1lRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ0biIsImNhcmREZWxldGVCdG4iLCJuYW1lIiwiYWx0Iiwic3JjIiwibGluayIsInRvZ2dsZSIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiaGFuZGxlT3ZlcmxheVByZXNzIiwiaGFuZGxlRXNjYXBlTW9kYWwiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlc2V0VmFsaWRhdGlvbiIsInZhbHVlIiwiaW5wdXQiLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsImNhcmRNb2RhbEJ0biIsImNhcmRNb2RhbCIsImNhcmRTdWJtaXRCdG4iLCJjYXJkRm9ybSIsImVkaXRMaW5rTW9kYWxJbnB1dCIsImVkaXRDYXB0aW9uTW9kYWxJbnB1dCIsImtleSIsIm1vZGFsT3BlbmVkIiwiY2xvc2VzdCIsInRhcmdldCIsImNvbnRhaW5zIiwiY2FyZEVsIiwicHJlcGVuZCIsInJlc2V0IiwiYnV0dG9uIiwiY2xvc2VQb3B1cCIsIml0ZW0iLCJhcHBlbmQiXSwic291cmNlUm9vdCI6IiJ9